{% extends "base.html" %}

{% block content %}


  <div class="container mt-5">
    <div class="row">
        <h1 class="title">
          Ciao {{ name }}!
        </h1>
    </div>
    <div class="row">
        {% include 'alert.html' %}
    </div>

    <div class="row">
        <h2> Richieste notifiche </h2>
        <table id="patientRequests" class="table">
            <thead>
                <tr>
                    
                    <th>Name</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for item in current_notifications_list %}
                    <tr class="patientRequest" data-id-doctor="{{ item.id_doctor}}" data-id-notification="{{item.id}}" >
                        <td>Il dottore {{ item.doctor_name }}</td>
                        <td><button class="btn btn-success sendLinkPatient" >Accetta</button></td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
    $('#patientRequests').on('click', '.sendLinkPatient', function() {
        var idDoctor = $(this).closest('.patientRequest').data('id-doctor');
        var idNotification = $(this).closest('.patientRequest').data('id-notification');
      // Send AJAX request to Flask endpoint
        $.ajax({
            type: 'POST',
            url: '/accept_doctor_request',
            contentType: 'application/json;charset=UTF-8',
            data: JSON.stringify({ 'id_doctor': idDoctor,"id_notification": idNotification }),
            success: function(response) {
                // Display the selected user details
                
                $('#alert_success').removeClass('d-none');

                setTimeout(function() {
                    $('#alert_success').addClass('d-none');
                }, 3000);
            
            },
            error: function(error) {
                console.error('Error:', error);
                $('#alert_danger').removeClass('d-none');

                setTimeout(function() {
                    $('#alert_danger').addClass('d-none');
                }, 3000);
            }
        });
    });

</script>
{% endblock %}