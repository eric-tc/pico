{% extends "base.html" %}

{% block content %}

<div class="row">

    <div class="col-md-6 mb-6 col-lg-6">
  
      <h4 class="title mt-3">
        Seleziona la patologia da trattare
      </h4>


      <form action="{{ url_for('doctor.pathology') }}" method="post">
        
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <div class="mb-3 mt-4">
            <label for="category" class="form-label">Patologia</label>
            <select class="form-select" id="pathology" name="pathology">

              {% for member in pathology %}
                <option value="{{member.value[0]}}">{{member.value[1]}}</option>
              {% endfor %}
            </select>
        </div>
  
        <div class="mb-3">
            <label for="pathology_type" class="form-label">Seleziona la patologia</label>
            <select class="form-select" id="pathology_type" name="pathology_type">
                <!-- Options will be dynamically populated based on the selected category -->
            </select>
        </div>
  
        <div class="mb-3" id="additionalFieldContainer" style="display: none;">
          <label for="additionalField" class="form-label">Additional Field</label>
          <input type="text" class="form-control" id="additionalField" name="additionalField">
        </div>

        <div id="radio_distale_giorni" style="display: none;" >

          <label for="radio_distale_giorni_value" class="form-label">Inserire Data Intervento</label>
          <p><input type="text" name="radio_distale_giorni_value"  id="radio_distale_datepicker" class="form-control-custom" ></p>
          
        </div>

        <div id="classificazione_radiografica" style="display: none;" >
          
          <h4>
           Classificazione Radiografica
          </h4>

          <label for="classificazione_radiografica_tipo_valore" class="form-label">Tipo Classificazione</label>
          <input type="text" name="classificazione_radiografica_tipo_valore"  id="classificazione_radiografica_tipo_valore" class="form-control-custom" >
          
          <label for="classificazione_radiografica_numero_valore" class="form-label">Numero Classificazione</label>
          <input type="text" name="classificazione_radiografica_numero_valore"  id="classificazione_radiografica_numero_valore" class="form-control-custom" >
          
        </div>



        <!-- Fratture Metacarpali -->
        <div id="fratture_metacarpali_step1" style="display: none;" >

          <label for="fratture_metacarpali_step1_valore" class="form-label">Tipo Classificazione</label>
          <input type="number" name="fratture_metacarpali_step1_valore"  id="fratture_metacarpali_step1_valore" class="form-control" >

          <label for="fratture_metacarpali_type" class="form-label">Seleziona Tipo</label>
          <select class="form-select" id="fratture_metacarpali_type" name="fratture_metacarpali_type">
              
            <option value="1">Chirurgico</option>
            <option value="2">Non Chirurgico</option>
            
          </select>
          
        </div>

        <div id="fratture_metacarpali_classificazione_radiografica" style="display: none;" >
          
          <label for="fratture_metacarpali_classificazione_radiografica_value" class="form-label">Viti</label>
          <select class="form-select" id="fratture_metacarpali_classificazione_radiografica_value" name="fratture_metacarpali_classificazione_radiografica_value">
              
            <option value="prossimale">Prossimale </option>
            <option value="diafisaria">Diafisaria</option>
            <option value="sottocapitata">Sottocapitata </option>
            <option value="distale_articolare">Distale articolare</option>
          </select>
        </div>

        
        <div id="fratture_metacarpali_non_chirurgico" style="display: none;" >
          <select class="form-select" id="fratture_metacarpali_chirurgico_type" name="fratture_metacarpali_chirurgico_type">
              
            <option value="1">Gesso Chiuso</option>
            <option value="2">Valva Gessata</option>
            <option value="3">Tutore Termoplastica</option>
            
          </select>
          
          <label for="non_chirirgico_polso">Polso</label>
          <select id="non_chirirgico_polso" name="non_chirirgico_polso">
            <option value="0">Si</option>
            <option value="1">No</option>
          </select>

          <label for="non_chirirgico_mcpj">MCPj</label>
          <select id="non_chirirgico_mcpj" name="non_chirirgico_mcpj">
            <option value="0">Si</option>
            <option value="1">No</option>
          </select>

          <label for="non_chirirgico_pipj">PIPj</label>
          <select id="non_chirirgico_pipj" name="non_chirirgico_pipj">
            <option value="0">Si</option>
            <option value="1">No</option>
          </select>
          
        </div>

        <div id="fratture_metacarpali_chirurgico" style="display: none;" >
          
          
          <label for="fratture_metacarpali_chirurgico_data" class="form-label">Inserire Data Intervento</label>
          <p><input type="text" name="fratture_metacarpali_chirurgico_data"  id="radio_distale_datepicker" class="form-control-custom" ></p>
          

          <label for="fratture_metacarpali_fili_kirschner" class="form-label">Fili Kirschner</label>
          <select class="form-select" id="fratture_metacarpali_fili_kirschner" name="fratture_metacarpali_fili_kirschner">
              
            <option value="endomidollari_anterogradi">Endomidollari anterogradi</option>
            <option value="endomidollari_retrogradi">Endomidollari retrogradi</option>
            <option value="trasversi">Trasversi</option>
            
          </select>

          <label for="fratture_metacarpali_viti" class="form-label">Viti</label>
          <select class="form-select" id="fratture_metacarpali_viti" name="fratture_metacarpali_viti">
              
            <option value="endomidollari">Endomidollari </option>
            <option value="lag">lag</option>
          </select>
          
        </div>


      

        <div class="mb-3">

          <h4>
            Selezionare i controlli futuri
          </h4>
        </div>
        {% include 'general/select_date.html' %}
      </div>
       
        
        <button type="submit" class="btn btn-primary">Prosegui per inserimento valori</button>
      </form>
    </div>      
  </div>

  <script>
    
    const jsonStringNames ='{{pathology_names_id_options | safe}}';
    var optionsByName = JSON.parse(jsonStringNames);
    console.log("SelectedPathology",selectedPathologyid);

    // Function to update options in the "Item" select based on the selected category
    function updateItemOptions() {
        const categorySelect = document.getElementById('pathology');
        const itemSelect = document.getElementById('pathology_type');
        const additionalFieldContainer = document.getElementById('additionalFieldContainer');
        const selectedCategory = categorySelect.value;



        if(categorySelect.value==3){

          fratture_metacarpali_step1
          $("#fratture_metacarpali_step1").show();
          $("#fratture_metacarpali_classificazione_radiografica").show();
        }
        else{

          $("#fratture_metacarpali_step1").hide();
          $("#fratture_metacarpali_classificazione_radiografica").hide();
        
          
        }
        //Frattura Radio Distale
        if(categorySelect.value==2){

          $("#classificazione_radiografica").show();

        }else{

          $("#classificazione_radiografica").hide();

        }

        if(categorySelect.value==3){
          
          fratture_metacarpali_step1
          $("#fratture_metacarpali_step1").show();
        }else{

          $("#fratture_metacarpali_step1").hide();
        }
        // Clear existing options
        itemSelect.innerHTML = '';
  
        var selectedOptions= optionsByName[selectedCategory];

        var name_array = selectedOptions["name"];
        var id_array= selectedOptions["id"];

        selectedPathologyid= selectedCategory;
        //Funzione presente nel file select_date. In pratica cambia la 
        //defaultDate del datepicker con quella selezionata dal paziente
        changeDefaultDate();
        console.log("UPDATE TIMELINE",selectedCategory);
        
        for (var i =0; i < id_array.length; i++){

          const option = document.createElement('option');
          option.value = id_array[i];
          
          option.textContent = name_array[i];
          itemSelect.appendChild(option);
          
        }
        console.log("ITEM SELECTED ", itemSelect.value);
        
      

        additionalFieldContainer.style.display = (itemSelect.value === 'Altro') ? 'block' : 'none';
    }
  
    function show_additional_field(){
      console.log("show_additional_field");
      const itemSelect = document.getElementById('pathology_type');
      additionalFieldContainer.style.display = (itemSelect.value === 'Altro') ? 'block' : 'none';
      

      console.log("PATHOLOGY TYPE ITEM SELECTED", itemSelect.value);
      if(itemSelect.value==5){
          
        console.log("frattura radio distale");
        $("#radio_distale_giorni").show();
      }else{
        $("#radio_distale_giorni").hide();
      }

      if(itemSelect.value==4 || itemSelect.value==5 || itemSelect.value==6){

        $("#classificazione_radiografica").show();
      }else{

        $("#classificazione_radiografica").hide();

      }

    }
  
    
    function frattura_metacarpale_add_fields(){

      const itemSelect = document.getElementById('fratture_metacarpali_type');
      
      //Chirurgico
      if(itemSelect.value==1){

        $("#fratture_metacarpali_non_chirurgico").hide();
        $("#fratture_metacarpali_chirurgico").show();
      
      }

      if(itemSelect.value==2){
        $("#fratture_metacarpali_chirurgico").hide();
        $("#fratture_metacarpali_non_chirurgico").show();

      }

    }
    // Attach the function to the "change" event of the "pathology" select
    document.getElementById('pathology').addEventListener('change', updateItemOptions);
  
     // Attach the function to the "change" event of the "pathology_type" select
     document.getElementById('pathology_type').addEventListener('change', show_additional_field);
    

     document.getElementById('fratture_metacarpali_type').addEventListener('change', frattura_metacarpale_add_fields);
  
  
    updateItemOptions();
    


    $("#radio_distale_datepicker").datepicker({
      dateFormat: 'dd-mm-yy', // Set the date format
      changeMonth: true,
      defaultDate: new Date(),
      changeYear: true,
      showOn: "button", // Show the Datepicker when clicking the button
      buttonText: "",
      // Add more options as needed
  });


  </script>

{% endblock %}