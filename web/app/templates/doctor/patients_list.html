
{% extends "base.html" %}

{% block content %}

<div class="container mt-5">

    <div class="row">
        {% include 'alert.html' %}
    </div>

    <div class="row">
        <h2>Lista Pazienti Presenti</h2>
        <table id="patientTable" class="table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for item in patients_list %}
                    <tr class="patientRow" data-patient-id="{{ item.id}}">
                        <td>{{ item.name }}</td>
                        <td>{{ item.name }}</td>
                        <td><button class="btn btn-primary sendLinkPatient" >Associa</button></td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>

    var csrftoken = $('meta[name=csrf-token]').attr('content')

    $.ajaxSetup({
        beforeSend: function(xhr, settings) {
            if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type)) {
                xhr.setRequestHeader("X-CSRFToken", csrftoken)
            }
        }
    })

    $('#patientTable').on('click', '.sendLinkPatient', function() {
        var patientId = $(this).closest('.patientRow').data('patient-id');
        
      // Send AJAX request to Flask endpoint
        $.ajax({
            type: 'POST',
            url: '/send_patient_notification',
            contentType: 'application/json',
            data: JSON.stringify({ 'patient_id': patientId }),
            success: function(response) {
                // Display the selected user details
                
                $('#alert_success').removeClass('d-none');

                setTimeout(function() {
                    $('#alert_success').addClass('d-none');
                }, 3000);
            
            },
            error: function(error) {
                console.error('Error:', error);
                $('#alert_danger').removeClass('d-none');

                setTimeout(function() {
                    $('#alert_danger').addClass('d-none');
                }, 3000);
            }
        });
    });

</script>

{% endblock %}