





    {{ pre_controls_form.hidden_hand_selection}}

<div>
     <div>
        <p>Clicca all'interno dei rettangoli interessati per inserire i valori. <b>Cliccando all'interno del rettangolo</b> si aprir√† una casella sotto il grafico. </p>
        <p>Inserisci i valori per salvari. <b>Inserisci il valore 0</b> per non conteggiare il valore o lascia vuoto</p>
        
    </div>

    <div style="display: flex; gap: 24px; align-items: center; margin-bottom: 12px;">
        <span style="display: flex; align-items: center;">
            <svg width="24" height="18" style="margin-right: 6px;"><rect width="24" height="18" fill="rgba(255,255,102,0.5)" stroke="#aaa"/></svg>
            <span>Estensione</span>
        </span>
        <span style="display: flex; align-items: center;">
            <svg width="24" height="18" style="margin-right: 6px;"><rect width="24" height="18" fill="rgba(0,200,83,0.4)" stroke="#aaa"/></svg>
            <span>Flessione</span>
        </span>
    </div>
    <svg id="interactiveImage" width="500" height="500" viewBox="0 0 500 500">
        <image href="{{ url_for('static', filename='dupuytren.png') }}" width="500" height="500" />
        <!-- Multiple rectangles with unique IDs -->
        
        <!-- mignolo -->
        <text id="text1" x="13" y="116" font-size="14" fill="black"></text>
        <rect id="rect1" x="12" y="102" width="26" height="18" fill="rgba(255,255,102,0.5)" data-id="1" />
        
        <text id="text2" x="40" y="116" font-size="14" fill="black"></text>
        <rect id="rect2" x="38" y="102" width="30" height="18" fill="rgba(0, 200, 83, 0.4)" data-id="2" />
        

        <text id="text3" x="27" y="170" font-size="14" fill="black"></text>
        <rect id="rect3" x="26" y="156" width="26" height="18" fill="rgba(255,255,102,0.5)" data-id="3" />

        <text id="text4" x="54" y="170" font-size="14" fill="black"></text>
        <rect id="rect4" x="52" y="156" width="30" height="18" fill="rgba(0, 200, 83, 0.4)" data-id="4" />
        

        <text id="text5" x="51" y="247" font-size="14" fill="black"></text>
        <rect id="rect5" x="50" y="233" width="26" height="18" fill="rgba(255,255,102,0.5)" data-id="5" />
        
        <text id="text6" x="78" y="247" font-size="14" fill="black"></text>
        <rect id="rect6" x="76" y="233" width="30" height="18" fill="rgba(0, 200, 83, 0.4)" data-id="6" />


        <!-- Anulare -->
        
        <text id="text7" x="142" y="34" font-size="14" fill="black"></text>
        <rect id="rect7" x="141" y="18" width="26" height="18" fill="rgba(255,255,102,0.5)" data-id="7" />

        <text id="text8" x="169" y="34" font-size="14" fill="black"></text>
        <rect id="rect8" x="167" y="18" width="30" height="18" fill="rgba(0, 200, 83, 0.4)" data-id="8" />


        <text id="text9" x="133" y="114" font-size="14" fill="black"></text>
        <rect id="rect9" x="132" y="98" width="26" height="18" fill="rgba(255,255,102,0.5)" data-id="9" />
        
        <text id="text10" x="160" y="114" font-size="14" fill="black"></text>
        <rect id="rect10" x="158" y="98" width="30" height="18" fill="rgba(0, 200, 83, 0.4)" data-id="10" />
        

        <text id="text11" x="131" y="200" font-size="14" fill="black"></text>
        <rect id="rect11" x="130" y="186" width="26" height="18" fill="rgba(255,255,102,0.5)" data-id="11" />

        <text id="text12" x="158" y="200" font-size="14" fill="black"></text>
        <rect id="rect12" x="156" y="186" width="30" height="18" fill="rgba(0, 200, 83, 0.4)" data-id="12" />
    
        <!-- Medio -->
        <text id="text13" x="284" y="50" font-size="14" fill="black"></text>
        <rect id="rect13" x="283" y="36" width="26" height="18" fill="rgba(255,255,102,0.5)" data-id="13" />

        <text id="text14" x="311" y="50" font-size="14" fill="black"></text>
        <rect id="rect14" x="309" y="36" width="30" height="18" fill="rgba(0, 200, 83, 0.4)" data-id="14" />
        

        <text id="text15" x="246" y="121" font-size="14" fill="black"></text>
        <rect id="rect15" x="245" y="105" width="26" height="18" fill="rgba(255,255,102,0.5)" data-id="15" />

        <text id="text16" x="273" y="121" font-size="14" fill="black"></text>
        <rect id="rect16" x="271" y="105" width="30" height="18" fill="rgba(0, 200, 83, 0.4)" data-id="16" />


        <text id="text17" x="210" y="207" font-size="14" fill="black"></text>
        <rect id="rect17" x="209" y="191" width="26" height="18" fill="rgba(255,255,102,0.5)" data-id="17" />

        <text id="text18" x="237" y="207" font-size="14" fill="black"></text>
        <rect id="rect18" x="235" y="191" width="30" height="18" fill="rgba(0, 200, 83, 0.4)" data-id="18" />
        
        <!-- Indice -->
        
        <text id="text19" x="400" y="114" font-size="14" fill="black"></text>
        <rect id="rect19" x="399" y="100" width="26" height="18" fill="rgba(255,255,102,0.5)" data-id="19" />

        <text id="text20" x="427" y="114" font-size="14" fill="black"></text>
        <rect id="rect20" x="425" y="100" width="30" height="18" fill="rgba(0, 200, 83, 0.4)" data-id="20" />


        <text id="text21" x="353" y="168" font-size="14" fill="black"></text>
        <rect id="rect21" x="352" y="152" width="26" height="18" fill="rgba(255,255,102,0.5)" data-id="21" />

        <text id="text22" x="380" y="168" font-size="14" fill="black"></text>
        <rect id="rect22" x="378" y="152" width="30" height="18" fill="rgba(0, 200, 83, 0.4)" data-id="22" />


        <text id="text23" x="293" y="240" font-size="14" fill="black"></text>
        <rect id="rect23" x="290" y="226" width="26" height="18" fill="rgba(255,255,102,0.5)" data-id="23" />

        <text id="text24" x="320" y="240" font-size="14" fill="black"></text>
        <rect id="rect24" x="318" y="226" width="30" height="18" fill="rgba(0, 200, 83, 0.4)" data-id="24" />

        <!-- Pollice -->

        <text id="text25" x="393" y="399" font-size="14" fill="black"></text>
        <rect id="rect25" x="392" y="383" width="26" height="18" fill="rgba(255,255,102,0.5)" data-id="25" />

        <text id="text26" x="420" y="399" font-size="14" fill="black"></text>
        <rect id="rect26" x="418" y="383" width="30" height="18" fill="rgba(0, 200, 83, 0.4)" data-id="26" />


        <text id="text27" x="277" y="419" font-size="14" fill="black"></text>
        <rect id="rect27" x="274" y="406" width="26" height="18" fill="rgba(255,255,102,0.5)" data-id="27" />

        <text id="text28" x="304" y="419" font-size="14" fill="black"></text>
        <rect id="rect28" x="300" y="406" width="30" height="18" fill="rgba(0, 200, 83, 0.4)" data-id="28" />
        
        
    </svg>
    <input type="number" style="display: none;" id="input-box" min="-120" max="120">
    <p id="error-message" style="color: red; display: none;">Il valore deve essere compreso tra -120 e 120</p>
</div>

{{ pre_controls_form.numero_interventi.label }}
{{ pre_controls_form.numero_interventi}}

<script>
    const indicesLabels = {{ indices_labels|tojson }};
    const currentSelection = {};
    // Define a default color to toggle on
   

    const mapping = {
    "1": "R_DIPJ_"+indicesLabels["MIGNOLO"],
    "2": "R_PIPJ_"+indicesLabels["MIGNOLO"],
    "3": "R_MCPJ_"+indicesLabels["MIGNOLO"],
    "4": "U_DIPJ_"+indicesLabels["MIGNOLO"],
    "5": "U_PIPJ_"+indicesLabels["MIGNOLO"],
    "6": "U_MCPJ_"+indicesLabels["MIGNOLO"],
    "7": "R_DIPJ_"+indicesLabels["ANULARE"],
    "8": "R_PIPJ_"+indicesLabels["ANULARE"],
    "9": "R_MCPJ_"+indicesLabels["ANULARE"],
    "10": "U_DIPJ_"+indicesLabels["ANULARE"],
    "11": "U_PIPJ_"+indicesLabels["ANULARE"],
    "12": "U_MCPJ_"+indicesLabels["ANULARE"],
    "13": "R_DIPJ_"+indicesLabels["MEDIO"],
    "14": "R_PIPJ_"+indicesLabels["MEDIO"],
    "15": "R_MCPJ_"+indicesLabels["MEDIO"],
    "16": "U_DIPJ_"+indicesLabels["MEDIO"],
    "17": "U_PIPJ_"+indicesLabels["MEDIO"],
    "18": "U_MCPJ_"+indicesLabels["MEDIO"],
    "19": "R_DIPJ_"+indicesLabels["INDICE"],
    "20": "R_PIPJ_"+indicesLabels["INDICE"],
    "21": "R_MCPJ_"+indicesLabels["INDICE"],
    "22": "U_DIPJ_"+indicesLabels["INDICE"],
    "23": "U_PIPJ_"+indicesLabels["INDICE"],
    "24": "U_MCPJ_"+indicesLabels["INDICE"],
    "25": "R_IPJ_"+indicesLabels["POLLICE"],
    "26": "R_MCPJ_"+indicesLabels["POLLICE"],
    "27": "U_IPJ_"+indicesLabels["POLLICE"],
    "28": "U_IPJ_"+indicesLabels["POLLICE"]
    };

    const inputBox = document.getElementById('input-box');

    document.getElementById("interactiveImage").addEventListener("click", function(event) {
        if (event.target.tagName === "rect") {
            const rect = event.target;
            const rectId = rect.getAttribute("data-id");

            console.log("rectId", rectId);
            const textElement = document.getElementById(`text${rectId}`);

            const rectBounds = this.getBoundingClientRect();
            const containerBounds = document.getElementById('interactiveImage').getBoundingClientRect();

            let errorMessage = document.getElementById("error-message");
            
            inputBox.style.left = `10px`;
            inputBox.style.top = `10px`;
            inputBox.style.width = `50px`;
            inputBox.style.height = `50px`;
            

            //inputBox.value = 0; // Pre-fill value if it exists
            inputBox.style.display = 'block';
            inputBox.focus();
            
            console.log("inputBox left", inputBox.style.left);
            console.log("inputBox top", inputBox.style.top);
            console.log("inputBox width", inputBox.style.width);
            console.log("inputBox height", inputBox.style.height);

            const mappingValue = mapping[rectId];

            inputBox.oninput = () => {
                console.log("inputBox value", "changed");

                if(inputBox.value<-120 || inputBox.value>120){
                    errorMessage.style.display = "block";  // Show error message
                    inputBox.value = "";  // Clear the input value
                }else{
                    errorMessage.style.display = "none";
                    currentSelection[mappingValue] = inputBox.value*1;
                    textElement.textContent = inputBox.value*1;
                }
            };

            document.getElementById("hidden_hand_selection").value = JSON.stringify(currentSelection);
            
            console.log("Current selection", currentSelection);

        }
    });

    
    document.addEventListener('click', function(event) {
        if (!event.target.matches('rect') && event.target.id !== 'input-box') {
            inputBox.style.display = 'none';
        }
    });

</script>