<form  id="form" method="POST">
    {{ form.csrf_token }}
    
    {% if event_in_range=="0" %}
        <h2 class="title mt-3">
            Puoi cambiare la data del controllo
        </h2>

        {{ form.orario_controllo.label }}
        {{ form.orario_controllo(id='timepicker', style="max-width:50%") }}

        
        {{ form.data_controllo.label }}
        
        <div class="mt-3 mb-3">
            {{ form.data_controllo(id='datepicker',style="max-width:50%") }}
        </div>

        {{form.submit_change_date(style="max-width:30%")}}

        <div class="row mt-2">
            <h4>Evento non aperto. Puoi compilare solo 5 giorni prima o 5 giorni dopo rispetto alla data indicata</h4>
        </div>
    {% endif %}
   

    {% if event_in_range=="1" %}

    <div class="row">

        <h2> Configuratore guidato terapia </h2>
        
        {% if data_inizio_mobilizzazione %}
            
            {{ form.data_inizio_mobilizzazione.label }}
        
            <div class="mt-3 mb-3">
                {{ form.data_inizio_mobilizzazione(id='generic-datepicker-no-res',style="max-width:50%") }}
            </div>
            
        {% endif %}

    </div> 

    {% include 'general/pathology_form_fields.html' %}
    
    {% endif %}

</form>

<script src="{{ url_for('static', filename='js/datepicker_custom_no_date_restriction.js') }}"></script>

<script>
    // Function to calculate the mean of the three grip values
    function calculateMeanGrip() {
        // Get the values of the three input fields
        const misurazione1 = parseFloat(document.getElementById('misurazione_1_grip').value) || 0;
        const misurazione2 = parseFloat(document.getElementById('misurazione_2_grip').value) || 0;
        const misurazione3 = parseFloat(document.getElementById('misurazione_3_grip').value) || 0;

        // Calculate the mean
        const mean = (misurazione1 + misurazione2 + misurazione3) / 3;

        // Set the value of the readonly grip field
        document.getElementById('grip').value = mean.toFixed(2); // Rounded to 2 decimal places
    }

    function calculateMeanFinger() {
        // Get the values of the three input fields
        const misurazione1 = parseFloat(document.getElementById('misurazione_1_finger').value) || 0;
        const misurazione2 = parseFloat(document.getElementById('misurazione_2_finger').value) || 0;
        const misurazione3 = parseFloat(document.getElementById('misurazione_3_finger').value) || 0;

        // Calculate the mean
        const mean = (misurazione1 + misurazione2 + misurazione3) / 3;

        // Set the value of the readonly grip field
        document.getElementById('finger').value = mean.toFixed(2); // Rounded to 2 decimal places
    }


    //Finger 

    document.getElementById('misurazione_1_finger').addEventListener('input', calculateMeanFinger);
    document.getElementById('misurazione_2_finger').addEventListener('input', calculateMeanFinger);
    document.getElementById('misurazione_3_finger').addEventListener('input', calculateMeanFinger);

    // Add event listeners to the three input fields to recalculate the mean on input change
    document.getElementById('misurazione_1_grip').addEventListener('input', calculateMeanGrip);
    document.getElementById('misurazione_2_grip').addEventListener('input', calculateMeanGrip);
    document.getElementById('misurazione_3_grip').addEventListener('input', calculateMeanGrip);

</script>